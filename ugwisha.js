(()=>{/* sheep */
const{parseEvents:e,getSchedule:t,getNote:n,saveScheduleData:s,prepareScheduleData:o,SCHEDULE_DATA_KEY:a,SCHEDULES_CALENDAR_ID:i,EVENTS_CALENDAR_ID:r,CALENDAR_KEYWORDS:d,GOOGLE_API_KEY:c,FIRST_DAY:l,LAST_DAY:u,DEFAULT_NAMES:p,DEFAULT_COLOURS:m,THEME_COLOUR:h,DEFAULT_FAVICON_URL:g,APP_NAME:f,PERIOD_OPTION_PREFIX:w,UPDATER_URL:v}=window.ugwishaOptions,y=[],E=[e=>window.isOnline=e],L={};window.UgwishaEvents={connection:new Promise(e=>E.push(e)),status:[]},window.Ugwisha={};try{window.storage=localStorage}catch(e){window.storage={getItem:e=>storage[e],setItem:(e,t)=>storage[e]=t,removeItem:e=>delete storage[e]}}try{window.options=JSON.parse(storage.getItem("[ugwisha] options")),"object"==typeof window.options&&null!==window.options||(window.options={})}catch(e){window.options={}}function b(){storage.setItem("[ugwisha] options",JSON.stringify(window.options))}const k={};window.location.search&&window.location.search.slice(1).split("&").forEach(e=>{const t=e.indexOf("=");~t?k[e.slice(0,t)]=e.slice(t+1):k[e]=!0});const C=["January","February","March","April","May","June","July","August","September","October","November","December"],T=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let I,x,D,S;function U(){!function(e){P(W),V=K=null,e.alternate&&W.appendChild(B("p",{className:"alternate-note"},["This is an alternate schedule."]));if(e.noSchool)return void W.appendChild(B("div",{className:"no-school",style:{backgroundImage:`url('./images/sheep/${function(e){const t=e/864e5%2==0,n=+e.toString(7)[9];return J[(t?0:7)+n]}(e.date.getTime())}')`}},[B("span",{},["No school!"])]));const t={};W.appendChild(R(e.map(e=>{const s=B("input",{className:"period-name",type:"text",placeholder:p[e.period],value:H(e.period),onchange(){_(e.period,s.value),b(),re(),t[e.period].inputs.forEach(e=>e!==s&&(e.value=s.value))},onfocus(){K!==a&&(V&&V.parentNode.removeChild(V),V=function(e,t="00BCD4",n=!0,s="009688"){let o,a,i,r,d=je($e(t||s));function c(t={}){const s=t.hex||Fe(Pe(d));o.value="#"+s,"initial"!==t.type&&e(n&&a.checked?null:s),i.style.backgroundColor=`hsl(${d.h}, 100%, 50%)`,i.style.setProperty("--x",100*d.s+"%"),i.style.setProperty("--y",100*(1-d.v)+"%"),r.style.backgroundImage=`linear-gradient(to bottom, ${_e.map(e=>(function({r:e,g:t,b:n}){return`rgb(${e}, ${t}, ${n})`})(Pe({h:e,s:d.s,v:d.v}))).join(",")})`,r.style.setProperty("--val",d.h/360*100+"%")}const l=B("div",{className:"colour-picker"},[o=B("input",{className:"colour-input select-input",type:"text",placeholder:"#123ABC",onchange(){const e=function(e){const t=He.exec(e.toLowerCase());return t?t[1]?t[1]:t.slice(2,5).map(e=>e+e).join(""):null}(o.value);e?(d=je($e(e)),n&&a.checked&&(a.checked=!1),c({type:"hex-input",hex:e})):o.value="#"+Fe(Pe(d))}}),B("div",{className:"colour-boxes-wrapper"},[i=B("div",{className:"colour-box"}),r=B("div",{className:"colour-slider"})]),n?B("label",{className:"colour-transparent-label"},[a=B("input",{className:"colour-transparent-checkbox",type:"checkbox",onchange:c}),"Transparent?"]):null]);n&&null===t&&(a.checked=!0);return Ye(i,(e,t)=>{d.s=qe(e),d.v=1-qe(t),n&&a.checked&&(a.checked=!1),c({type:"square"})}),Ye(r,(e,t)=>{d.h=360*qe(t),n&&a.checked&&(a.checked=!1),c({type:"hue"})}),c({type:"initial",hex:t||s}),l}(n=>{q(e.period,n),b(),re(),t[e.period].cards.forEach(e=>{null===n?(e.classList.add("transparent"),e.classList.remove("dark-text"),e.style.setProperty("--colour",null)):(e.classList.remove("transparent"),e.style.setProperty("--colour","#"+n),G(n)?e.classList.add("dark-text"):e.classList.remove("dark-text"))})},Y(e.period),!0,m[e.period]||"000000"),s.parentNode.insertBefore(V,s.nextElementSibling),K=a)}}),o=n(e),a=B("div",{className:["period",null===Y(e.period)?"transparent":G(Y(e.period))?"dark-text":null],style:{"--colour":Y(e.period)&&"#"+Y(e.period)}},[s,B("span",{className:"time-duration"},[B("span",{className:"time",innerHTML:$(e.start)+" &ndash; "+$(e.end)}),B("span",{className:"duration"},[e.end-e.start+" min"]),o?B("span",{className:"note",innerHTML:o}):null])]);return t[e.period]||(t[e.period]={inputs:[],cards:[]}),t[e.period].inputs.push(s),t[e.period].cards.push(a),a})))}(t(A));const e=A.getUTCDay(),s=[];for(let n=0;n<7;n++)s.push(t(new Date(A.getTime()-864e5*(e-n))));var o,a;o=s,a=e,X.forEach((e,t)=>{a===t?e.wrapper.classList.add("week-preview-today"):e.wrapper.classList.remove("week-preview-today"),P(e.content);const n=o[t];n.alternate?e.wrapper.classList.add("week-preview-is-alternate"):e.wrapper.classList.remove("week-preview-is-alternate"),e.date=n.date,e.content.appendChild(R(n.noSchool?[]:n.map(e=>B("span",{className:["week-preview-cell","week-preview-period",null===Y(e.period)?"week-preview-transparent":null],title:H(e.period),"aria-label":H(e.period),style:{backgroundColor:Y(e.period)&&"#"+Y(e.period)}}))))})}function N(){U(),S.innerHTML=C[A.getUTCMonth()]+" "+A.getUTCDate(),I.innerHTML=T[A.getUTCDay()];const e=A.getTime();x.disabled=e<=l,D.disabled=e>=u,I.href=(k["no-sw"]?"?no-sw&":"?")+"day="+A.toISOString().slice(0,10),fe()}let A=k.day?new Date(k.day):M();function M(){return new Date(Date.UTC(...(e=>[e.getFullYear(),e.getMonth(),e.getDate()])(new Date)))}function O(e){return Array.isArray(e)?e.filter(e=>void 0!==e&&null!==e&&!1!==e):(Object.keys(e).forEach(t=>(void 0===e[t]||null===e[t]||!1===e[t])&&delete e[t]),e)}function B(e,t={},n=[]){const s=document.createElement(e);return Object.keys(O(t)).forEach(e=>{const n=t[e];if("data"===e)Object.keys(O(n)).forEach(e=>{s.dataset[e]=n[e]});else if("style"===e)Object.keys(O(n)).forEach(e=>{"--"===e.slice(0,2)?s.style.setProperty(e,n[e]):s.style[e]=n[e]});else if("ripple"===e)Re(s);else if("on"===e.slice(0,2))s.addEventListener(e.slice(2),n);else{const t=Array.isArray(n)?O(n).join(" "):n.toString();void 0!==s[e]?s[e]=t:s.setAttribute(e,t)}}),Array.isArray(n)||(n=[n]),O(n).forEach(e=>{s.appendChild("object"!=typeof e?document.createTextNode(e):e)}),s}function R(e){const t=document.createDocumentFragment();return O(e).forEach(e=>t.appendChild(e)),t}function P(e){for(;e.firstChild;)e.removeChild(e.firstChild)}document.addEventListener("DOMContentLoaded",()=>{S=document.getElementById("select-date"),I=document.getElementById("weekday"),x=document.getElementById("back-day"),D=document.getElementById("forth-day");const e=Array.from(document.getElementsByClassName("toggle-setting"));e.forEach(e=>{const t=e.dataset.option;void 0===options[t]&&(options[t]="true"===e.dataset.default)}),y.forEach(e=>e()),UgwishaExtensions.start();let t=!1;document.addEventListener("keydown",e=>{9!==e.keyCode&&13!==e.keyCode||(document.body.classList.add("tab-focus"),t=!0)}),document.addEventListener("keyup",e=>{9!==e.keyCode&&13!==e.keyCode||(t=!1)}),document.addEventListener("focusin",()=>{t||document.body.classList.remove("tab-focus")});const n=document.getElementById("psa"),s=document.getElementById("psa-content"),o=document.getElementById("psa-close"),a=document.getElementById("psa-btn");fetch("./psa.html?v="+Date.now()).then(e=>e.text()).then(e=>{s.innerHTML=e;const t=e.slice(6,9);options.lastPSA&&options.lastPSA!==t&&(n.classList.remove("hidden"),o.focus(),document.body.style.overflow="hidden"),options.lastPSA||(options.lastPSA=t,b()),o.addEventListener("click",()=>{n.classList.add("hidden"),options.lastPSA!==t&&(options.lastPSA=t,b(),!Ce&&e.includes("[REFETCH]")&&(Ce=!0,Ee().then(U))),a.focus(),document.body.style.overflow=null}),E.forEach(e=>e(!0))}).catch(()=>{document.getElementById("offline-msg").classList.remove("hidden");const e=document.getElementById("reload");e.tabindex=0,e.addEventListener("click",e=>{window.location.reload(),e.preventDefault()}),a.disabled=!0,options.natureLoaded||(document.getElementById("nature-back").disabled=!0),E.forEach(e=>e(!1))});let i=window.innerWidth,r=window.innerHeight;window.addEventListener("resize",()=>{i=window.innerWidth,r=window.innerHeight});const d=document.getElementById("jump");let c=!1;document.addEventListener("wheel",()=>{window.cancelAnimationFrame(c),c=!1},{passive:!0}),document.addEventListener("touchstart",()=>{window.cancelAnimationFrame(c),c=!1},{passive:!0}),document.addEventListener("scroll",()=>{window.scrollY>r/3?d.classList.add("up"):d.classList.remove("up")}),d.addEventListener("click",()=>{c&&window.cancelAnimationFrame(c),function(e){let t=window.scrollY;!function n(){Math.abs(t-e)>1?(t+=(e-t)/5,window.scrollTo(0,t),c=window.requestAnimationFrame(n)):(window.scrollTo(0,e),c=!1)}()}(d.classList.contains("up")?0:r-50)});let l=null,u=null;document.getElementById("tabs").addEventListener("click",e=>{if(e.target.dataset.for){let t=l;l&&(l.classList.remove("selected"),u.classList.remove("show"),l=null,u=null),t!==e.target&&("psa"===e.target.dataset.for?(n.classList.remove("hidden"),o.focus(),document.body.style.overflow="hidden"):(l=e.target,u=document.getElementById(e.target.dataset.for),e.target.classList.add("selected"),u.classList.add("show")))}});const p=document.getElementById("events-wrapper"),m={showDuration(e){e?document.body.classList.add("show-duration"):document.body.classList.remove("show-duration")},showTime(e){e?document.body.classList.add("show-time"):document.body.classList.remove("show-time")},metricTime(){U(),re()},showSELF(){U(),ie=null,re()},quickTransitions(e){e?document.body.classList.add("quick-transitions"):document.body.classList.remove("quick-transitions")},showEvents(e){e&&fe(),p.style.display=e?null:"none"}};e.forEach(e=>{const t=e.dataset.option;e.checked=options[t];const n=m[t]||L[t];e.addEventListener("change",()=>{options[t]=e.checked,n&&n(e.checked),b()})}),options.showDuration&&document.body.classList.add("show-duration"),options.showTime&&document.body.classList.add("show-time"),options.quickTransitions&&document.body.classList.add("quick-transitions"),options.showEvents||(p.style.display="none"),I.addEventListener("click",e=>{window.history.pushState({},"",I.href),e.preventDefault()}),x.addEventListener("click",()=>{A=new Date(A.getTime()-864e5),N()}),D.addEventListener("click",()=>{A=new Date(A.getTime()+864e5),N()}),document.getElementById("today").addEventListener("click",()=>{A=M(),N()});const h=document.getElementById("content"),g=document.getElementById("drag-handle");function f(e){const t="m"===e.type[0]?e:e.changedTouches[0];options.sidebarWidth=Math.max(250,Math.min(700,i-200,t.clientX-100)),h.style.setProperty("--custom-width",(options.sidebarWidth||250)+"px"),e.preventDefault()}function w(e){document.removeEventListener("mouseup"===e.type?"mousemove":"touchmove",f),document.removeEventListener(e.type,w),e.preventDefault(),b()}g.addEventListener("mousedown",e=>{document.addEventListener("mousemove",f),document.addEventListener("mouseup",w),e.preventDefault()}),g.addEventListener("touchstart",e=>{document.addEventListener("touchmove",f,{passive:!1}),document.addEventListener("touchend",w,{passive:!1}),e.preventDefault()},{passive:!1}),h.style.setProperty("--custom-width",(options.sidebarWidth||250)+"px")},{once:!0}),"serviceWorker"in navigator&&(k["no-sw"]||k["reset-sw"]?navigator.serviceWorker.getRegistrations().then(e=>{Promise.all(e.map(e=>e.unregister())).then(()=>{k["reset-sw"]?window.location=v:e.length&&window.location.reload()})}).catch(()=>void 0):window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(e=>{e.onupdatefound=(()=>{const t=e.installing;t.onstatechange=(()=>{"installed"===t.state&&navigator.serviceWorker.controller&&(options.natureLoaded=!1,window.location.replace(v))})})},()=>{}),navigator.serviceWorker.addEventListener("message",({data:e})=>{e.type})},{once:!0})),window.Elem=B,window.Fragment=R,window.empty=P;const j=32;function $(e,t=!1){const n=Math.floor(e/60),s=("0"+e%60).slice(-2);let o=options.metricTime?`${n}:${s}`:`${(n+11)%12+1}:${s}`;return options.metricTime||t?o:`${o} ${n<12?"a":"p"}m`}function F(e,t=!1,n=!1){return t?(n&&e<60?"":Math.floor(e/60))+":"+("0"+e%60).slice(-2):e+" minute"+(1===e?"":"s")}function H(e){return options["periodName_"+w+e]}function _(e,t){return options["periodName_"+w+e]=t}function Y(e){return options["periodColour_"+w+e]}function q(e,t){return options["periodColour_"+w+e]=t}let W,X;Ugwisha.formatTime=$,Ugwisha.formatDuration=F,Ugwisha.getPdName=H,Ugwisha.getPdColour=Y;const J=["left-sheep-curious.svg","left-sheep-running-sad-D.svg","left-sheep-standing-blowing-caterpillars.svg","right-sheep-D-mouth.svg","right-sheep-fishing.svg","right-sheep-hot-air-balloon.svg","right-sheep-sleeping.svg","standing-sheep-arms-out.svg","standing-sheep-classy.svg","standing-sheep-doing-ballet.svg","standing-sheep-flowers.svg","standing-sheep-hungry.svg","two-sheep-ice-cream.svg","two-sheep-stack.svg"];function G(e){const[t,n,s]=[e.slice(0,2),e.slice(2,4),e.slice(4)].map(e=>(e=parseInt(e,16)/255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4));return.2126*t+.7152*n+.0722*s>.179}let V,K;document.addEventListener("click",e=>{V&&!K.contains(e.target)&&(V.parentNode.removeChild(V),V=K=null)});const z=["S","M","T","W","&Theta;","F","S"];const Q=(new Date).getTimezoneOffset();const Z=B("canvas",{width:j,height:j}),ee=Z.getContext("2d");let te,ne,se,oe,ae,ie;function re(e=!1,n=0){const s=Date.now();if(e&&s<n)return setTimeout(()=>re(!0,n),Math.min(n-s,1e3));const o=M(),a=o.toISOString().slice(0,10);ie!==a&&(ie=a,(ae=t(o)).noSchool&&(se.style.opacity=0,oe.setAttribute("href",g),document.title=f));const i=function(e,t=0){const n=Date.now()+t,s=Math.floor((n/6e4-Q)%1440),o=n+6e4-n%6e4;if(e.noSchool)return{type:"time",value:s,nextMinute:o};const a=e.find(e=>e.end>s),i={secondCounter:null,nextMinute:o};if(a)i.period=a,a.start>s?(i.type="until",i.value=a.start-s):(i.type="left in",i.value=a.end-s,i.progress=(s-a.start)/(a.end-a.start)),i.value<=1&&(i.secondCounter=(()=>{const e=Date.now()+t;return{secondsLeft:60-e/1e3%60,stop:Math.floor((e/6e4-Q)%1440)>=(a.start>s?a.start:a.end)}}));else{const t=e[e.length-1];i.period=t,i.type="since",i.value=s-t.end}return i}(ae);if(ae.noSchool)te.textContent=$(i.value,!0),ne.textContent="";else{if("left in"===i.type?(se.style.opacity=1,se.style.setProperty("--progress",100*i.progress+"%")):se.style.opacity=0,ne.innerHTML=i.type+" "+function(e){const t=Y(e);let n='<span class="period-chip';return null===t&&(n+=" transparent"),null!==t&&G(t)&&(n+=" dark-text"),n+='"',null!==t&&(n+=` style="--colour: #${t};"`),n+=`>${H(e)}</span>`}(i.period.period),"since"===i.type)te.textContent=F(i.value,!0),oe.setAttribute("href",g),document.title=f;else if(function(e){ee.clearRect(0,0,j,j),ee.font="100px 'Roboto Condensed', sans-serif";const{width:t}=ee.measureText(e),n=j/(t/100);ee.fillStyle=h,ee.fillRect(0,(j-1.2*n)/2,j,n),ee.font=`${n}px 'Roboto Condensed', sans-serif`,ee.fillStyle="white",ee.fillText(e,j/2,j/2),oe.setAttribute("href",Z.toDataURL())}(F(i.value,!0,!0)),e&&i.secondCounter){!function t(){const{secondsLeft:n,stop:s}=i.secondCounter();if(!s){const e=Math.round(100*n)/100+"";document.title=(te.textContent=e+(e.includes(".")?"0".repeat(3-e.length+e.indexOf(".")):".00")+"s")+" "+i.type+" "+H(i.period.period)+" - "+f}window.requestAnimationFrame(e&&!s?t:re)}()}else document.title=(te.textContent=F(i.value,!0))+" "+i.type+" "+H(i.period.period)+" - "+f;e&&UgwishaEvents.status.forEach(e=>e(i,s))}e&&setTimeout(()=>re(!0,i.nextMinute),Math.min(i.nextMinute-s,1e3))}function de(e){return Math.floor(Math.random()*e)}function ce(e){const t=B("div",{className:"transition-background"});t.style.backgroundImage=document.body.style.backgroundImage;const n=setTimeout(()=>{document.body.removeChild(t)},1e4);t.addEventListener("animationend",()=>{document.body.removeChild(t),clearTimeout(n)}),document.body.insertBefore(t,document.body.firstChild),document.body.style.backgroundImage=e}y.push(()=>{W=document.getElementById("periods"),Object.keys(p).forEach(e=>{void 0===H(e)&&_(e,p[e])}),Object.keys(m).forEach(e=>{void 0===Y(e)&&q(e,m[e])}),te=document.getElementById("preview-time"),ne=document.getElementById("preview-msg"),se=document.getElementById("progress"),oe=document.getElementById("favicon"),ee.textAlign="center",ee.textBaseline="middle",X=[];for(let e=0;e<7;e++){const t={};t.wrapper=B("div",{className:"week-preview-col",tabindex:0,onclick(){A=t.date,N()},onkeydown(e){13===e.keyCode&&this.click()}},[B("span",{className:"week-preview-cell week-preview-alternate",title:"Alternate schedule","aria-label":"This is an alternate schedule"},["*"]),B("span",{className:"week-preview-cell week-preview-day-heading",innerHTML:z[e],title:T[e],"aria-label":T[e]}),t.content=B("div")]),X.push(t)}document.getElementById("week-preview").appendChild(R(X.map(({wrapper:e})=>e)));let e=null;W.addEventListener("touchstart",t=>{if(!e&&options.allowSliding){const n=t.changedTouches[0];e={id:n.identifier,startX:n.clientX,slide:!1}}}),W.addEventListener("touchmove",t=>{if(e){const n=Array.from(t.touches).find(t=>t.identifier===e.id);if(n){const t=n.clientX-e.startX;e.slide||Math.abs(t)>30&&(e.slide=!0),e.slide&&(W.style.transform=`translateX(${t/5}px)`,W.style.opacity=Math.abs(t)>60?.5:null)}}}),W.addEventListener("touchend",t=>{if(e){const n=Array.from(t.changedTouches).find(t=>t.identifier===e.id);if(n){const t=n.clientX-e.startX;t>60?x.click():t<-60&&D.click()}W.style.transform=null,W.style.opacity=null,e=null}})});const le="ugwisha-backgrounds";async function ue(e,t){const n=new Headers;n.append("pragma","no-cache"),n.append("Cache-Control","no-cache");const s=await fetch(e,{mode:"no-cors",headers:n,cache:"no-cache"}),o=await caches.open(le);await o.delete(new Request(t)),await o.put(new Request(t),s)}y.push(()=>{const e=document.getElementById("set-back"),t=document.getElementById("reset-back"),n=document.getElementById("next-back");let s=null;function o(){s&&clearInterval(s),s=options.randomGradients?setTimeout(o,options.quickTransitions?5e3:1e4):null,ce(function(){const e=[de(256),de(256),de(256)],t=[de(256),de(256),de(256)];return`linear-gradient(${360*Math.random()}deg, rgb(${e.join(",")}), rgb(${t.join(",")}))`}())}const a=[],i=["nature","water","wallpaper"];i.forEach((e,t)=>{const n=[...i.slice(0,t),...i.slice(t+1)];a.push(e),a.push(e+","+n[0]),a.push(e+","+n[0]+","+n[1]),a.push(e+","+n[1]),a.push(e+","+n[1]+","+n[0])}),a.push(...a.map(e=>e+","+Date.now()));let r=-1;function d(){n.disabled=!0,r=(r+1)%a.length,ue("https://source.unsplash.com/random/1600x900/?"+a[r],"nature").then(()=>{ce(`url("nature?n=${Date.now()}")`),options.natureLoaded=!0,b(),n.disabled=!1}).catch(()=>{ce('url("./images/temp-sheep.png")'),n.disabled=!1})}function c(){options.natureLoaded?(ce(`url("nature?n=${Date.now()}")`),n.disabled=!1):d()}options.backgroundURL?(ce(`url("custom?n=${Date.now()}")`),t.disabled=!1):options.natureBackground?(ce(`url("nature?n=${Date.now()}")`),n.disabled=!1,caches.open(le).then(e=>e.match("nature")).then(e=>{e||d()})):o(),e.addEventListener("click",()=>{const o=prompt("URL of image: (sorry for lack of proper UI)");o&&(e.disabled=!0,n.disabled=!0,ue(o,"custom").then(()=>{e.disabled=!1,t.disabled=!1,ce(`url("custom?n=${Date.now()}")`),options.backgroundURL=o,b(),s&&clearInterval(s)}).catch(()=>{e.disabled=!1,!options.backgroundURL&&options.natureBackground&&(n.disabled=!1),alert("The image couldn't be loaded. This might be because:\n- You are offline\n- The website hosting the image won't let Ugwisha load their images\n- There's something wrong with the URL\n(sorry again for lack of proper UI)")}))}),t.addEventListener("click",()=>{options.backgroundURL=null,b(),t.disabled=!0,n.disabled=!options.natureBackground,options.natureBackground?c():o()}),n.addEventListener("click",d),L.natureBackground=(e=>{options.backgroundURL||(e?(s&&clearInterval(s),c()):(o(),n.disabled=!0))}),L.randomGradients=(e=>{e?options.natureBackground||options.backgroundURL||o():s&&clearInterval(s)}),E.push(t=>{t||(n.disabled=e.disabled=!0)})});const pe={},me="https://www.googleapis.com/calendar/v3/calendars/"+encodeURIComponent(r)+"/events?singleEvents=true&fields="+encodeURIComponent("items(description,end(date,dateTime),location,start(date,dateTime),summary)")+"&key="+c;function he(e){return 60*e.getHours()+e.getMinutes()}function ge(e,t=0){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+t)}async function fe(){if(options.showEvents){const n=A.toISOString().slice(0,10);if(be.innerHTML='<span class="events-message">Loading...</span>',!pe[n]){const{items:t}=await fetch(`${me}&timeMin=${encodeURIComponent(ge(A).toISOString())}&timeMax=${encodeURIComponent(ge(A,1).toISOString())}`).then(e=>e.json()).catch(()=>(be.innerHTML='<span class="events-message">Unable to fetch events.</span>',{items:null}));if(!t)return;pe[n]=t,e(Le({items:t}),A)&&(storage.setItem(a,s()),U(),ie=null,re())}P(be),be.appendChild(pe[n].length?R(pe[n].map(e=>B("div",{className:"event"},[B("span",{className:"event-name"},[e.summary]),B("span",{className:"event-info"},[e.start&&e.start.dateTime?B("span",{className:"event-time",innerHTML:$(he(new Date(e.start.dateTime)))+" &ndash; "+$(he(new Date(e.end.dateTime)))}):null,e.location?B("span",{className:"event-location"},[e.location]):null]),e.description?B("span",{className:"event-description",innerHTML:(t=e.description,t.replace(/(<.*?) style=(?:"[^"]*"|\S*)(.*?>)/g,"$1$2"))}):null]))):B("span",{className:"events-message"},["Nothing happening today"]))}var t}const we=new Date(l+252e5),ve=new Date(u+111599999),ye="https://www.googleapis.com/calendar/v3/calendars/"+encodeURIComponent(i)+"/events?singleEvents=true&fields="+encodeURIComponent("items(description,end(date,dateTime),start(date,dateTime),summary)")+"&key="+c+`&timeMin=${encodeURIComponent(we.toISOString())}&timeMax=${encodeURIComponent(ve.toISOString())}`;function Ee(){return ke.disabled=!0,Promise.all(d.map(e=>fetch(ye+"&q="+e).then(e=>e.json()))).then(t=>{const n={};t.map(Le).forEach(e=>e.forEach(e=>{n[e.date]||(n[e.date]=[]),n[e.date].push(e)}));const o=new Date(l),i=u;for(;o.getTime()<=i;)e(n[o.toISOString().slice(0,10)]||[],o),o.setUTCDate(o.getUTCDate()+1);storage.setItem(a,s()),ke.disabled=!1})}function Le({items:e}){const t=[];return e.forEach(e=>{if(e.start.dateTime)t.push({summary:e.summary,description:e.description,date:e.start.dateTime.slice(0,10)});else{const n=new Date(e.start.date),s=new Date(e.end.date).getTime();for(;n.getTime()<s;)t.push({summary:e.summary,description:e.description,date:n.toISOString().slice(0,10)}),n.setUTCDate(n.getUTCDate()+1)}}),t}let be,ke,Ce=!1;y.push(async()=>{if(be=document.getElementById("events"),(ke=document.getElementById("fetch-alts")).addEventListener("click",()=>{Ce=!0,Ee().then(U)}),E.push(e=>{e||(ke.disabled=!0)}),k["get-alts"]||!storage.getItem(a)){if(Ce=!0,await Ee(),k.then)return window.location.replace(k.then);ie=null}o(storage.getItem(a)),N(),re(!0,0)});const Te=[],Ie={},xe=24,De=6*xe;let Se,Ue,Ne,Ae;y.push(()=>{Ue=document.getElementById("date-selector");const e=document.getElementById("date-selector-days");Se=document.getElementById("date-selector-month-year");let n=!1,s=!1;function o(t,n=!1){s&&window.cancelAnimationFrame(s);const o=Math.max(Math.min((+t.dataset.week+.5)*xe-De/2,e.scrollHeight-De),0);n&&(e.scrollTop=o),function t(){e.scrollTop+=(o-e.scrollTop)/5,s=window.requestAnimationFrame(t)}()}document.getElementById("date-selector-day-headings").appendChild(R(z.map(e=>B("span",{className:"date-selector-day-heading",innerHTML:e})))),e.addEventListener("wheel",()=>{s&&window.cancelAnimationFrame(s)}),e.addEventListener("touchstart",()=>{s&&window.cancelAnimationFrame(s)}),e.addEventListener("scroll",()=>{const t=(e.scrollTop+De/2)/xe,n=Te.findIndex(e=>e.start>=t),s=Te[(~n?n:Te.length)-1];s&&s!==Ne&&(Ne&&Ne.wrapper.classList.remove("date-selector-month-selected"),Ne=s,s.wrapper.classList.add("date-selector-month-selected"),Se.textContent=C[s.month]+" "+s.year)}),e.addEventListener("click",e=>{e.target.classList.contains("date-selector-day")&&!e.target.classList.contains("date-selector-out-of-bounds")&&(A=new Date(e.target.dataset.date),N(),Ae&&Ae.classList.remove("date-selector-selected"),e.target.classList.add("date-selector-selected"),Ae=e.target,o(e.target))}),e.addEventListener("keydown",e=>{if(e.keyCode>=37&&e.keyCode<=40){let t;switch(e.keyCode){case 37:t=-1;break;case 38:t=-7;break;case 39:t=1;break;case 40:t=7}const n=new Date(Date.UTC(A.getUTCFullYear(),A.getUTCMonth(),A.getUTCDate()+t));if(n.getTime()>=l&&n.getTime()<=u){A=n,N();const e=Ie[n.toISOString().slice(0,10)];e&&(Ae&&Ae.classList.remove("date-selector-selected"),e.classList.add("date-selector-selected"),Ae=e,o(e))}e.preventDefault()}else 27===e.keyCode&&(Ue.classList.add("hidden"),a.focus())});const a=document.getElementById("select-date");a.addEventListener("click",s=>{n||(e.appendChild(function(){const e=document.createDocumentFragment(),t=new Date(l),n=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()-t.getUTCDay()));let s,o=-1;for(;n.getTime()<=u;){const t=n.getUTCMonth();if(0===n.getUTCDay()&&o++,s!==t){s=t;const a=B("span",{className:"date-selector-month"});e.appendChild(a),Te.push({month:t,year:n.getUTCFullYear(),wrapper:a,start:o})}const a=Te[Te.length-1],i=n.getTime(),r=n.getUTCDate();r<=5&&(a.start=o);const d=i<l||i>u,c=n.toISOString().slice(0,10),p=B("span",{className:["date-selector-day",d&&"date-selector-out-of-bounds"],data:{date:c,week:o}},[r]);d||(Ie[c]=p),a.wrapper.appendChild(p),n.setUTCDate(n.getUTCDate()+1)}return e}()),n=!0),function(){const e=M().toISOString().slice(0,10);Object.keys(Ie).forEach(n=>{const s=Ie[n],o=new Date(n),a=t(o);s.classList[a.noSchool?"add":"remove"]("date-selector-no-school"),s.classList[a.alternate?"add":"remove"]("date-selector-alternate"),s.classList[n===e?"add":"remove"]("date-selector-today")})}(),Ue.classList.remove("hidden"),Ae&&Ae.classList.remove("date-selector-selected");const a=Ie[A.toISOString().slice(0,10)];a&&(a.classList.add("date-selector-selected"),Ae=a,o(a,!0)),e.focus(),s.stopPropagation()}),document.getElementById("cancel-select-date").addEventListener("click",()=>{Ue.classList.add("hidden"),a.focus()}),document.addEventListener("click",e=>{Ue.classList.contains("hidden")||Ue.contains(e.target)||Ue.classList.add("hidden")})});let Me=[];function Oe(){(Me=Me.filter(e=>e.animate())).length&&window.requestAnimationFrame(Oe)}document.addEventListener("mouseup",()=>{Me.filter(e=>"mouse"===e.identifier).forEach(e=>e.dying=!0)}),document.addEventListener("touchend",e=>{Array.from(e.changedTouches).forEach(e=>{Me.filter(t=>t.identifier===e.identifier).forEach(e=>e.dying=!0)})},{passive:!0});class Be{constructor(e,t,n,s){const o=B("div",{className:"ripple"}),a=e.getBoundingClientRect();o.style.left=t-a.left+"px",o.style.top=n-a.top+"px",e.appendChild(o),Me.push(this),this.parent=e,this.ripple=o,this.identifier=s,this.scale=0,this.dying=!1,this.dyingProgress=1,this.finalScale=Math.hypot(Math.max(t-a.left,a.left+a.width-t),Math.max(n-a.top,a.top+a.height-n))/5,1===Me.length&&Oe()}animate(){return this.scale+=(this.finalScale-this.scale)/6,this.dying&&(this.dyingProgress-=.07),this.ripple.style.transform=`scale(${this.scale})`,this.ripple.style.opacity=this.dyingProgress,this.dyingProgress<=0&&this.parent.removeChild(this.ripple),this.dyingProgress>0}}function Re(e){let t=!1;e.addEventListener("touchstart",n=>{t=!0,Array.from(n.changedTouches).forEach(t=>{new Be(e,t.clientX,t.clientY,t.identifier)})},{passive:!0}),e.addEventListener("mousedown",n=>{t?t=!1:new Be(e,n.clientX,n.clientY,"mouse")})}function Pe({h:e,s:t,v:n}){const s=s=>{const o=(s+e/60)%6;return n-n*t*Math.max(Math.min(o,4-o,1),0)};return{r:255*s(5),g:255*s(3),b:255*s(1)}}function je({r:e,g:t,b:n}){e/=255,t/=255,n/=255;const s=Math.min(e,t,n),o=Math.max(e,t,n),a=o-s;let i=o===s&&e===t&&t===n?0:o===e?60*(t-n)/a:o===t?60*(2+(n-e)/a):60*(4+(e-t)/a);return i<0&&(i+=360),{h:i,s:0===o&&0===s?0:a/o,v:o}}function $e(e){return{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4),16)}}function Fe({r:e,g:t,b:n}){return[e,t,n].map(e=>Math.floor(e).toString(16).padStart(2,"0")).join("")}y.push(()=>{Array.from(document.getElementsByClassName("ripples")).forEach(e=>Re(e))}),window.UgwishaExtensions=(()=>{const e="[ugwisha] extensions",t="[ugwisha] extensions.last",n="ugwisha-extensions",s={};let o,a,i,r,d=!1,c=null;const l=JSON.parse(storage.getItem(e)||'["./js/extensions/notes.js"]'),u=Promise.all(l.map(p));function p(e){return new Promise((t,n)=>{document.head.appendChild(B("script",{onload:t,onerror:n,src:e}))}).then(()=>{caches.open(n).then(t=>t.add(e))})}let m=!1;const h={start:function(){d=!0,delete h.start,o=document.getElementById("extension-name"),a=document.getElementById("extension-icon"),i=document.getElementById("extension-menu"),r=document.getElementById("extension-wrapper"),h.switch=(e=>{if(e===c)return;if(!s[e]){if(!s.menu)return;e="menu"}if(c){const e=s[c];e.beforeRemove&&e.beforeRemove(),r.removeChild(e.wrapper),e.afterRemove&&e.afterRemove()}c=e;const n=s[e];o.textContent=n.name,n.icon?(a.style.backgroundImage=`url("${n.icon}")`,a.style.display=null):a.style.display="none",n.beforeAdd&&n.beforeAdd(),r.appendChild(n.wrapper),n.afterAdd&&n.afterAdd(),localStorage.setItem(t,e),i.disabled="menu"===e}),i.addEventListener("click",()=>{h.switch("menu")}),u.then(()=>h.switch(k.app||localStorage.getItem(t)||"menu")),E.push(e=>{e||(w.disabled=!0)})},register(t){if(s[t.id])throw new Error("Extension with same ID already exists: "+t.id);if("menu"!==t.id&&!l.includes(t.url))throw new Error("No extensions are loaded with this URL: "+t.url);if(s[t.id]=t,"menu"!==t.id){const o=B("div",{className:"extension-item"},[B("div",{className:"kind-of-button extension-icon",tabindex:0,ripple:!0,style:{backgroundImage:t.icon&&`url("${t.icon}")`},onclick(i){if(m){delete s[t.id];const i=l.indexOf(t.url);~i&&(l.splice(i,1),storage.setItem(e,JSON.stringify(l))),f.removeChild(o);const r=g.find(e=>e[1]===t.url);r&&(r[2].disabled=!1),caches.open(n).then(e=>Promise.all([t.url,...a].map(t=>e.delete(t)))).then(()=>void 0)}else h.switch(t.id)},onkeydown(e){13===e.keyCode&&this.click()}}),B("div",{className:"extension-name"},[t.name])]);f.appendChild(o),t.styles&&document.head.appendChild(B("link",{rel:"stylesheet",href:t.styles}));const a=t.sources||[];t.icon&&a.push(t.icon),t.styles&&a.push(t.styles),a.length&&caches.open(n).then(e=>e.addAll(a))}}},g=[["Notes","./js/extensions/notes.js"],["Todo","./js/extensions/todo.js"],["Barcode","./js/extensions/barcode.js"],["Min. Score Calc.","./js/extensions/min-score.js"],["Discord Webhook","./js/extensions/discord-webhook.js"],["Push Notifications","./js/extensions/notifications.js"],["Current Second","./js/extensions/current-second.js"]],f=B("div",{className:"extension-menu"}),w=B("select",{className:"select-input extension-list",value:"CHOOSE",onchange(e){v.disabled="CHOOSE"===w.value}},[B("option",{value:"CHOOSE",disabled:!0},["Add app"]),B("option",{value:"FROM_URL"},["From URL"]),...g.map(e=>e[2]=B("option",{value:e[1],disabled:l.includes(e[1])},[e[0]]))]),v=B("button",{className:"button extension-add",disabled:!0,ripple:!0,onclick(t){let n=w.value;"CHOOSE"!==n&&("FROM_URL"===n&&(n=prompt("Enter app URL:")),n&&function(t){l.includes(t)?Promise.reject(new Error("Extension already added")):(l.push(t),p(t).then(()=>{storage.setItem(e,JSON.stringify(l));const n=g.find(e=>e[1]===t);n&&(n[2].disabled=!0)}))}(n),w.value="CHOOSE",v.disabled=!0)}},["Add"]);return h.register({id:"menu",wrapper:B("div",{},[f,B("div",{className:"extension-list-wrapper"},[w,v]),B("button",{className:"button extension-remove",ripple:!0,onclick(e){(m=!m)?(f.classList.add("extension-remove-mode"),this.classList.add("extension-removing"),this.childNodes[0].nodeValue="Done"):(f.classList.remove("extension-remove-mode"),this.classList.remove("extension-removing"),this.childNodes[0].nodeValue="Remove apps")}},["Remove apps"])]),name:"Apps"}),h})();const He=/([0-9a-f]{6})|([0-9a-f])([0-9a-f])([0-9a-f])/i;const _e=[0,60,120,180,240,300,360];function Ye(e,t){let n;function s(e){const s="touch"===e.type.slice(0,5)?e.touches[0]:e;t((s.clientX-n.left)/n.width,(s.clientY-n.top)/n.height)}function o(t){n=e.getBoundingClientRect(),s(t),document.addEventListener("touchstart"===t.type?"touchmove":"mousemove",a,{passive:!1}),document.addEventListener("touchstart"===t.type?"touchend":"mouseup",i,{passive:!1}),t.stopPropagation(),t.preventDefault()}function a(e){s(e),e.preventDefault()}function i(e){document.removeEventListener("touchend"===e.type?"touchmove":"mousemove",a),document.removeEventListener(e.type,i),e.preventDefault()}e.addEventListener("mousedown",o,{passive:!1}),e.addEventListener("touchstart",o,{passive:!1})}function qe(e,t=0,n=1){return e>n?n:e<t?t:e}})()
